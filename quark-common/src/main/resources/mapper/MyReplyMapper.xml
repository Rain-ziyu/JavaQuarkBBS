<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quark.common.mapper.MyReplyMapper">

    <resultMap id="reply" type="com.quark.common.entity.MyReply">
        <id property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="initTime"  column="init_time"/>
        <association property="user" javaType="com.quark.common.entity.User" >
            <id property="id" column="user_id"/>
            <result property="username" column="username"/>
        </association>
        <collection property="myReplies" select="selectRereply" column="id"  ofType="com.quark.common.entity.MyReply"/>
    </resultMap>
    <resultMap id="Rereply" type="com.quark.common.entity.MyRereply">
        <id property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="initTime"  column="init_time"/>
        <association property="hfuser" javaType="com.quark.common.entity.User" >
            <id property="id" column="hfuser_id"/>
            <result property="username" column="username"/>
        </association>
        <association property="bhfuser" javaType="com.quark.common.entity.User" >
            <id property="id" column="bhfuser_id"/>
            <result property="username" column="username"/>
        </association>
    </resultMap>
    <select id="listMyReply" resultMap="reply">
        select r.*,
               u.username
        from quark_reply r,
             quark_user u
        where r.user_id =u.id
        <if test="ew.sqlSegment != null and ew.sqlSegment != ''">
            AND ${ew.sqlSegment}
        </if>
    </select>
    <select id="selectRereply" resultMap="Rereply">
        select r.*,u.username from my_reply r,quark_user u where r.reply_id=#{id} and (u.id=r.hfuser_id or u.id=r.bhfuser_id)
    </select>

</mapper>